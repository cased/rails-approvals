# Rails::Approvals

Add approval processes for Rails console access, running database migrations, and more in production. Be notified of approval requests and respond to them directly in Slack.

## Installation

Rails::Approvals requires a Slack application installed in your Slack workspace before approvals can be requested and responded to.

### Create Slack application

To create the Rails::Approvals Slack application for your workspace you must be a Slack workspace administrator. Using the link below a new Slack application will be prefilled with all settings and scopes required for Rails::Approvals to work. Slack will prompt you to verify the permissions that will be granted before the Slack application is created.

[Create Slack Application](https://api.slack.com/apps?new_app=1&manifest_json=%7B%0A%20%20%22_metadata%22%3A%20%7B%0A%20%20%20%20%22major_version%22%3A%201%2C%0A%20%20%20%20%22minor_version%22%3A%201%0A%20%20%7D%2C%0A%20%20%22display_information%22%3A%20%7B%0A%20%20%20%20%22name%22%3A%20%22Rails%20Approvals%22%0A%20%20%7D%2C%0A%20%20%22features%22%3A%20%7B%0A%20%20%20%20%22app_home%22%3A%20%7B%0A%20%20%20%20%20%20%22home_tab_enabled%22%3A%20false%2C%0A%20%20%20%20%20%20%22messages_tab_enabled%22%3A%20true%2C%0A%20%20%20%20%20%20%22messages_tab_read_only_enabled%22%3A%20true%0A%20%20%20%20%7D%2C%0A%20%20%20%20%22bot_user%22%3A%20%7B%0A%20%20%20%20%20%20%22display_name%22%3A%20%22Rails%20Approvals%22%2C%0A%20%20%20%20%20%20%22always_online%22%3A%20false%0A%20%20%20%20%7D%0A%20%20%7D%2C%0A%20%20%22oauth_config%22%3A%20%7B%0A%20%20%20%20%22scopes%22%3A%20%7B%0A%20%20%20%20%20%20%22bot%22%3A%20%5B%0A%20%20%20%20%20%20%20%20%22chat%3Awrite%22%0A%20%20%20%20%20%20%5D%0A%20%20%20%20%7D%0A%20%20%7D%2C%0A%20%20%22settings%22%3A%20%7B%0A%20%20%20%20%22interactivity%22%3A%20%7B%0A%20%20%20%20%20%20%22is_enabled%22%3A%20true%2C%0A%20%20%20%20%20%20%22request_url%22%3A%20%22https%3A%2F%2Fwebsite.com%2Frails%2Fapprovals%2Fslack%2Fwebhook%22%0A%20%20%20%20%7D%2C%0A%20%20%20%20%22org_deploy_enabled%22%3A%20false%2C%0A%20%20%20%20%22socket_mode_enabled%22%3A%20false%0A%20%20%7D%0A%7D%0A)

If you'd like to setup the Slack application manually you can do so following [Setup Slack Application](#setup-slack-application) guide below.

### Install the rails-approvals gem

Now that you have the Slack application setup, you can add this line to your application's Gemfile to install `rails-approvals`:

```ruby
gem 'rails-approvals'
```

And then execute:

```bash
$ bundle
```

Or add it automatically with:

```bash
$ bundle add rails-approvals
```

### Run database migration

```
bin/rails railsapprovals:install:migrations
bin/rails db:migrate
```

### Configuring rails-approvals

Rails::Approvals needs three things to work:

1. The Slack Bot User OAuth Token generated after installing the Slack application to your workspace. This lets the gem publish messages to your configured Slack channel.
1. The Webhook signing secret generated by Slack.
1. The Slack channel to send approval requests to.

Each of these can be configured by environment variables or manually in your environment file. We strongly do not recommend checking in any API tokens into version control and using environment variables to configure them.

```ruby
Rails.application.configure do
  # Enabled by default in production. If you'd like to enable approvals in
  # staging or other environments you can do so.
  config.rails.approvals.enabled = true

  # Can be configured with RAILS_APPROVALS_SLACK_CHANNEL by default, or provided
  # explicitely.
  config.rails.approvals.slack.channel = "#rails-approvals"

  # Can be configured with RAILS_APPROVALS_SLACK_TOKEN. Strongly do not
  # recommended checking this into version control.
  config.rails.approvals.slack.token = ENV['RAILS_APPROVALS_SLACK_TOKEN']

  # Can be configured with RAILS_APPROVALS_SLACK_SIGNING_SECRET. Strongly do not
  # recommended checking this into version control.
  config.rails.approvals.slack.signing_secret = ENV['RAILS_APPROVALS_SLACK_SIGNING_SECRET']
end
```

## How does Rails::Approvals work?

-

## Setup Slack Application

- `groups:read`
- If the channel is private, you must invite the bot user to the channel first.

## Contributing

1. Fork it ( https://github.com/cased/rails-approvals/fork )
2. Create your feature branch (`git checkout -b my-new-feature`)
3. Commit your changes (`git commit -am 'Add some feature'`)
4. Push to the branch (`git push origin my-new-feature`)
5. Create a new Pull Request

## License

The gem is available as open source under the terms of the [MIT License](https://opensource.org/licenses/MIT).
